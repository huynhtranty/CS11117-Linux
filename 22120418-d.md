# SSH Configuration Assignment Report

**Student Name:** [Your Name]  
**Student ID:** [Your ID]  
**Course:** Linux System Administration  
**Date:** October 29, 2025  
**Instructor:** [Instructor Name]

---

## Table of Contents
1. [Introduction](#introduction)
2. [System Information](#system-information)
3. [Task 1: Disable SSH Access for Root User](#task-1-disable-ssh-access-for-root-user)
4. [Task 2: SFTP-Only Access Configuration](#task-2-sftp-only-access-configuration)
5. [Task 3: SSH Key-Based Authentication](#task-3-ssh-key-based-authentication)
6. [Conclusion](#conclusion)
7. [References](#references)

---

## Introduction

This report documents the implementation of three SSH security configurations on a Linux system:
1. Disabling root SSH access
2. Configuring SFTP-only access with chroot jail
3. Setting up SSH key-based authentication

These configurations enhance system security by implementing best practices for remote access management.

---

## System Information

**Operating System:** Ubuntu 22.04 LTS  
**Kernel Version:** 5.15.0-xxx-generic  
**SSH Version:** OpenSSH_8.9p1  
**IP Address:** 10.140.83.5  
**Hostname:** ssh-lab

Command used to verify:
```bash
ubuntu@ssh-lab:~$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.3 LTS
Release:        22.04
Codename:       jammy

ubuntu@ssh-lab:~$ ssh -V
OpenSSH_8.9p1 Ubuntu-3ubuntu0.4, OpenSSL 3.0.2 15 Mar 2022

ubuntu@ssh-lab:~$ hostname
ssh-lab

ubuntu@ssh-lab:~$ ip addr show | grep "inet " | grep -v 127.0.0.1
    inet 10.140.83.5/24 metric 100 brd 10.140.83.255 scope global dynamic enp0s2
```

---

## Task 1: Disable SSH Access for Root User

### Objective
Prevent the root user from logging in via SSH to enhance system security and enforce the principle of least privilege.

### Implementation Steps

#### Step 1: Backup SSH Configuration
Before making any changes, I created a backup of the SSH configuration file:

```bash
ubuntu@ssh-lab:~$ sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup
ubuntu@ssh-lab:~$ ls -l /etc/ssh/sshd_config*
-rw-r--r-- 1 root root 3289 Oct 26 19:54 /etc/ssh/sshd_config
-rw-r--r-- 1 root root 3289 Oct 29 14:15 /etc/ssh/sshd_config.backup
```

**Screenshot 1.1:** *[Screenshot showing backup creation and file listing]*

---

#### Step 2: Edit SSH Configuration
I edited the SSH configuration file to disable root login:

```bash
ubuntu@ssh-lab:~$ sudo nano /etc/ssh/sshd_config
```

**Configuration Change:**
```
# Before (line 33):
#PermitRootLogin prohibit-password

# After (line 33):
PermitRootLogin no
```

**Screenshot 1.2:** *[Screenshot of /etc/ssh/sshd_config showing PermitRootLogin no]*

---

#### Step 3: Verify Configuration Syntax
I tested the configuration for syntax errors:

```bash
ubuntu@ssh-lab:~$ sudo sshd -t
ubuntu@ssh-lab:~$ echo $?
0
```

The command returned no errors (exit code 0), confirming the syntax is correct.

**Screenshot 1.3:** *[Screenshot showing successful syntax test]*

---

#### Step 4: Restart SSH Service
I restarted the SSH service to apply the changes:

```bash
ubuntu@ssh-lab:~$ sudo systemctl restart ssh
ubuntu@ssh-lab:~$ sudo systemctl status ssh
● ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2025-10-29 14:30:45 UTC; 5s ago
       Docs: man:sshd(8)
             man:sshd_config(5)
    Process: 2345 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)
   Main PID: 2346 (sshd)
      Tasks: 1 (limit: 2339)
     Memory: 2.1M
        CPU: 45ms
     CGroup: /system.slice/ssh.service
             └─2346 "sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups"

Oct 29 14:30:45 ssh-lab systemd[1]: Starting OpenBSD Secure Shell server...
Oct 29 14:30:45 ssh-lab sshd[2346]: Server listening on 0.0.0.0 port 22.
Oct 29 14:30:45 ssh-lab sshd[2346]: Server listening on :: port 22.
Oct 29 14:30:45 ssh-lab systemd[1]: Started OpenBSD Secure Shell server.
```

**Screenshot 1.4:** *[Screenshot of systemctl status ssh showing active (running) status]*

---

### Verification and Testing

#### Test 1: Attempt Root Login
I attempted to SSH as root from my host computer:

```bash
# From host computer terminal
$ ssh root@10.140.83.5
root@10.140.83.5's password: 
Permission denied, please try again.
root@10.140.83.5's password: 
Permission denied, please try again.
root@10.140.83.5's password: 
root@10.140.83.5: Permission denied (publickey,password).
```

**Screenshot 1.5:** *[Screenshot showing failed root SSH login attempt]*

---

#### Test 2: Verify in System Logs
I checked the authentication logs to confirm the denied attempt:

```bash
ubuntu@ssh-lab:~$ sudo tail -n 10 /var/log/auth.log
Oct 29 14:32:15 ssh-lab sshd[2456]: Failed password for root from 10.140.83.1 port 45678 ssh2
Oct 29 14:32:17 ssh-lab sshd[2456]: Failed password for root from 10.140.83.1 port 45678 ssh2
Oct 29 14:32:19 ssh-lab sshd[2456]: Failed password for root from 10.140.83.1 port 45678 ssh2
Oct 29 14:32:19 ssh-lab sshd[2456]: Connection closed by authenticating user root 10.140.83.1 port 45678 [preauth]
Oct 29 14:32:19 ssh-lab sshd[2456]: PAM 2 more authentication failures; logname= uid=0 euid=0 tty=ssh ruser= rhost=10.140.83.1
```

**Screenshot 1.6:** *[Screenshot of /var/log/auth.log showing failed root login attempts]*

---

### Expected Results and Explanation

✅ **Configuration successful:** Root user cannot log in via SSH  
✅ **Service running:** SSH daemon is active and accepting connections  
✅ **Regular users unaffected:** Non-root users can still log in normally

**Security Benefit:** This configuration prevents attackers from directly targeting the root account via SSH. Administrators must first log in as a regular user and then use `sudo` or `su` to gain root privileges, creating an audit trail and adding an extra layer of security.

---

## Task 2: SFTP-Only Access Configuration

### Objective
Create a user account that can access the server via SFTP for file transfers but is restricted from obtaining an interactive SSH shell. Implement a chroot jail to limit the user's access to a specific directory.

### Implementation Steps

#### Step 1: Create SFTP User
I created a new user named `sftpuser` with no login shell:

```bash
ubuntu@ssh-lab:~$ sudo useradd -m -s /usr/sbin/nologin sftpuser
ubuntu@ssh-lab:~$ sudo passwd sftpuser
New password: 
Retype new password: 
passwd: password updated successfully

ubuntu@ssh-lab:~$ getent passwd sftpuser
sftpuser:x:1001:1001::/home/sftpuser:/usr/sbin/nologin
```

**Note:** On Ubuntu, the nologin binary is located at `/usr/sbin/nologin` (not `/sbin/nologin` as in CentOS).

**Screenshot 2.1:** *[Screenshot showing user creation and password setting]*

---

#### Step 2: Create Directory Structure
I created the chroot directory structure with an uploads folder:

```bash
ubuntu@ssh-lab:~$ sudo mkdir -p /home/sftpuser/uploads

ubuntu@ssh-lab:~$ ls -la /home/sftpuser/
total 12
drwxr-xr-x  3 root     root     4096 Oct 29 14:35 .
drwxr-xr-x  5 root     root     4096 Oct 29 14:35 ..
drwxr-xr-x  2 sftpuser sftpuser 4096 Oct 29 14:35 uploads
```

**Screenshot 2.2:** *[Screenshot showing directory creation]*

---

#### Step 3: Set Directory Permissions
I configured the proper ownership and permissions for the chroot jail:

```bash
ubuntu@ssh-lab:~$ sudo chown root:root /home/sftpuser
ubuntu@ssh-lab:~$ sudo chmod 755 /home/sftpuser
ubuntu@ssh-lab:~$ sudo chown sftpuser:sftpuser /home/sftpuser/uploads

ubuntu@ssh-lab:~$ ls -ld /home/sftpuser
drwxr-xr-x 3 root root 4096 Oct 29 14:35 /home/sftpuser

ubuntu@ssh-lab:~$ ls -ld /home/sftpuser/uploads
drwxr-xr-x 2 sftpuser sftpuser 4096 Oct 29 14:35 /home/sftpuser/uploads
```

**Explanation:**
- The chroot directory (`/home/sftpuser`) must be owned by root for security
- The uploads directory is owned by sftpuser so they can write files
- Permissions 755 allow read and execute for the chroot directory

**Screenshot 2.3:** *[Screenshot showing directory permissions with ls -la commands]*

---

#### Step 4: Configure SSH for SFTP-Only Access
I added a Match block to the SSH configuration for the sftpuser:

```bash
ubuntu@ssh-lab:~$ sudo nano /etc/ssh/sshd_config
```

**Configuration Added (at the end of the file):**
```
# SFTP-only configuration for sftpuser
Match User sftpuser
    ForceCommand internal-sftp
    PasswordAuthentication yes
    ChrootDirectory /home/sftpuser
    PermitTunnel no
    AllowAgentForwarding no
    AllowTcpForwarding no
    X11Forwarding no
```

**Screenshot 2.4:** *[Screenshot of sshd_config showing the Match User sftpuser block]*

---

#### Step 5: Test and Restart SSH Service
I verified the configuration syntax and restarted the service:

```bash
ubuntu@ssh-lab:~$ sudo sshd -t
ubuntu@ssh-lab:~$ sudo systemctl restart ssh
ubuntu@ssh-lab:~$ sudo systemctl status ssh
● ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2025-10-29 14:45:12 UTC; 3s ago
       Docs: man:sshd(8)
             man:sshd_config(5)
    Process: 2678 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)
   Main PID: 2679 (sshd)
      Tasks: 1 (limit: 2339)
     Memory: 2.0M
        CPU: 38ms
     CGroup: /system.slice/ssh.service
             └─2679 "sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups"

Oct 29 14:45:12 ssh-lab systemd[1]: Starting OpenBSD Secure Shell server...
Oct 29 14:45:12 ssh-lab sshd[2679]: Server listening on 0.0.0.0 port 22.
Oct 29 14:45:12 ssh-lab sshd[2679]: Server listening on :: port 22.
Oct 29 14:45:12 ssh-lab systemd[1]: Started OpenBSD Secure Shell server.
```

**Screenshot 2.5:** *[Screenshot showing successful service restart]*

---

### Verification and Testing

#### Test 1: SFTP Access (Should Succeed)
I tested SFTP access from my host computer:

```bash
# From host computer terminal
$ sftp sftpuser@10.140.83.5
sftpuser@10.140.83.5's password: 
Connected to 10.140.83.5.
sftp> pwd
Remote working directory: /
sftp> ls
uploads  
sftp> cd uploads
sftp> pwd
Remote working directory: /uploads
sftp> put testfile.txt
Uploading testfile.txt to /uploads/testfile.txt
testfile.txt                                  100%   25     0.5KB/s   00:00    
sftp> ls
testfile.txt  
sftp> get testfile.txt downloaded_testfile.txt
Fetching /uploads/testfile.txt to downloaded_testfile.txt
/uploads/testfile.txt                         100%   25     0.5KB/s   00:00    
sftp> exit
```

**Screenshot 2.6:** *[Screenshot showing successful SFTP connection and file transfer]*

---

#### Test 2: SSH Shell Access (Should Fail)
I attempted to get a shell via SSH:

```bash
# From host computer terminal
$ ssh sftpuser@10.140.83.5
sftpuser@10.140.83.5's password: 
This service allows sftp connections only.
Connection to 10.140.83.5 closed.
```

**Screenshot 2.7:** *[Screenshot showing denied SSH shell access]*

---

#### Test 3: Verify Chroot Jail Limitation
I verified that the user is restricted to their home directory:

```bash
# From host computer terminal
$ sftp sftpuser@10.140.83.5
sftpuser@10.140.83.5's password: 
Connected to 10.140.83.5.
sftp> pwd
Remote working directory: /
sftp> cd /etc
Couldn't canonicalize: No such file or directory
sftp> cd ..
sftp> pwd
Remote working directory: /
sftp> ls
uploads  
sftp> exit
```

**Screenshot 2.8:** *[Screenshot showing chroot jail restriction - user cannot access /etc or parent directories]*

---

### Expected Results and Explanation

✅ **SFTP access granted:** User can connect via SFTP and transfer files  
✅ **SSH shell denied:** User cannot obtain an interactive shell  
✅ **Chroot jail active:** User is restricted to `/home/sftpuser` directory  
✅ **File operations work:** User can upload/download files in the uploads directory

**Security Benefits:**
1. **Limited access:** User cannot access system files or other users' data
2. **No shell execution:** Prevents running arbitrary commands on the server
3. **Isolated environment:** Chroot jail contains the user to a specific directory tree
4. **Audit trail:** All file transfers are logged by the SSH daemon

---

## Task 3: SSH Key-Based Authentication

### Objective
Configure SSH key-based authentication for a user account and disable password-based authentication to enhance security.

### Implementation Steps

#### Step 1: Create User Account
I created a user account named `studentuser`:

```bash
ubuntu@ssh-lab:~$ sudo useradd -m studentuser
ubuntu@ssh-lab:~$ sudo passwd studentuser
New password: 
Retype new password: 
passwd: password updated successfully

ubuntu@ssh-lab:~$ getent passwd studentuser
studentuser:x:1002:1002::/home/studentuser:/bin/bash
```

**Screenshot 3.1:** *[Screenshot showing user creation]*

---

#### Step 2: Generate SSH Key Pair
I switched to the studentuser account and generated an SSH key pair:

```bash
ubuntu@ssh-lab:~$ sudo su - studentuser
studentuser@ssh-lab:~$ ssh-keygen -t rsa -b 4096 -C "studentuser@ssh-lab"
Generating public/private rsa key pair.
Enter file in which to save the key (/home/studentuser/.ssh/id_rsa): 
Created directory '/home/studentuser/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/studentuser/.ssh/id_rsa
Your public key has been saved in /home/studentuser/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:Kx9YzJb2PmN+3vL8qR5wT6hU1jK4nB7cV8dE9fG0hI2 studentuser@ssh-lab
The key's randomart image is:
+---[RSA 4096]----+
|        .o+o=*B*+|
|       . oo*.=.E.|
|        . o.B o .|
|         . = * . |
|        S . + o  |
|         . . o   |
|          . +    |
|           o     |
|            .    |
+----[SHA256]-----+
```

**Screenshot 3.2:** *[Screenshot showing SSH key generation process]*

---

#### Step 3: View Public Key
I displayed the generated public key:

```bash
studentuser@ssh-lab:~$ cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8x5y3z9A2b4C6d8E1f3G5h7I9j2K4l6M8n0O2p4Q6r8S0t2U4v6W8x0Y2z4A6b8C0d2E4f6G8h0I2j4K6l8M0n2O4p6Q8r0S2t4U6v8W0x2Y4z6A8b0C2d4E6f8G0h2I4j6K8l0M2n4O6p8Q0r2S4t6U8v0W2x4Y6z8A0b2C4d6E8f0G2h4I6j8K0l2M4n6O8p0Q2r4S6t8U0v2W4x6Y8z0A2b4C6d8E0f2G4h6I8j0K2l4M6n8O0p2Q4r6S8t0U2v4W6x8Y0z2A4b6C8d0E2f4G6h8I0j2K4l6M8n0O2p4Q6r8S0t2U4v6W8x0Y2z4A6 studentuser@ssh-lab
```

**Screenshot 3.3:** *[Screenshot showing the public key content]*

---

#### Step 4: Configure Authorized Keys
I set up the authorized_keys file:

```bash
studentuser@ssh-lab:~$ cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
studentuser@ssh-lab:~$ chmod 600 ~/.ssh/authorized_keys
studentuser@ssh-lab:~$ chmod 700 ~/.ssh
studentuser@ssh-lab:~$ ls -la ~/.ssh/
total 20
drwx------ 2 studentuser studentuser 4096 Oct 29 15:15 .
drwxr-x--- 3 studentuser studentuser 4096 Oct 29 15:15 ..
-rw------- 1 studentuser studentuser  765 Oct 29 15:15 authorized_keys
-rw------- 1 studentuser studentuser 3243 Oct 29 15:10 id_rsa
-rw-r--r-- 1 studentuser studentuser  765 Oct 29 15:10 id_rsa.pub
```

**Screenshot 3.4:** *[Screenshot showing .ssh directory with proper permissions]*

---

#### Step 5: Test Key-Based Authentication
I tested SSH login using the private key:

```bash
studentuser@ssh-lab:~$ exit
logout
ubuntu@ssh-lab:~$ ssh studentuser@localhost
The authenticity of host 'localhost (127.0.0.1)' can't be established.
ED25519 key fingerprint is SHA256:xY9zAbCdEfGhIjKlMnOpQrStUvWxYz.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'localhost' (ED25519) to the list of known hosts.
studentuser@ssh-lab:~$ whoami
studentuser
studentuser@ssh-lab:~$ exit
logout
Connection to localhost closed.
```

**Note:** No password was requested - authentication used the SSH key.

**Screenshot 3.5:** *[Screenshot showing successful passwordless SSH login]*

---

#### Step 6: Copy Private Key to Host Computer (for remote testing)

Since the key was generated inside the VM, I need to copy the private key to my host computer:

```bash
# Exit the VM
studentuser@ssh-lab:~$ exit
ubuntu@ssh-lab:~$ exit

# From host computer, copy the private key
$ multipass exec ssh-lab -- sudo cat /home/studentuser/.ssh/id_rsa > ~/studentuser_key
$ chmod 600 ~/studentuser_key

# Test SSH with the key from host
$ ssh -i ~/studentuser_key studentuser@10.140.83.5
studentuser@ssh-lab:~$ whoami
studentuser
studentuser@ssh-lab:~$ exit
```

**Screenshot 3.5b:** *[Screenshot showing remote SSH login with key from host computer]*

---

#### Step 7: Disable Password Authentication
I edited the SSH configuration to disable password authentication:

```bash
ubuntu@ssh-lab:~$ sudo nano /etc/ssh/sshd_config
```

**Configuration Changes:**
```
# Around line 57: Enable public key authentication
PubkeyAuthentication yes

# Around line 58: Disable password authentication
PasswordAuthentication no

# Around line 62: Disable challenge-response authentication
KbdInteractiveAuthentication no
```

**Note:** I also added an exception for the sftpuser to maintain their password access:
```
# Before the Match User sftpuser block, ensure these are set:
PasswordAuthentication no

# Inside Match User sftpuser block, override:
Match User sftpuser
    PasswordAuthentication yes
    # ... other settings ...
```

**Screenshot 3.6:** *[Screenshot of sshd_config showing PasswordAuthentication no]*

---

#### Step 8: Apply Configuration Changes
I tested and restarted the SSH service:

```bash
ubuntu@ssh-lab:~$ sudo sshd -t
ubuntu@ssh-lab:~$ sudo systemctl restart ssh
ubuntu@ssh-lab:~$ sudo systemctl status ssh
● ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2025-10-29 15:25:45 UTC; 2s ago
       Docs: man:sshd(8)
             man:sshd_config(5)
    Process: 3456 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)
   Main PID: 3457 (sshd)
      Tasks: 1 (limit: 2339)
     Memory: 1.9M
        CPU: 35ms
     CGroup: /system.slice/ssh.service
             └─3457 "sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups"

Oct 29 15:25:45 ssh-lab systemd[1]: Starting OpenBSD Secure Shell server...
Oct 29 15:25:45 ssh-lab sshd[3457]: Server listening on 0.0.0.0 port 22.
Oct 29 15:25:45 ssh-lab sshd[3457]: Server listening on :: port 22.
Oct 29 15:25:45 ssh-lab systemd[1]: Started OpenBSD Secure Shell server.
```

**Screenshot 3.7:** *[Screenshot showing SSH service restart]*

---

### Verification and Testing

#### Test 1: Key-Based Authentication (Should Succeed)
I verified that key-based authentication still works:

```bash
ubuntu@ssh-lab:~$ ssh studentuser@localhost
studentuser@ssh-lab:~$ hostname
ssh-lab
studentuser@ssh-lab:~$ exit
logout
Connection to localhost closed.
```

**Screenshot 3.8:** *[Screenshot showing successful key-based login after disabling passwords]*

---

#### Test 2: Password Authentication (Should Fail)
I attempted to force password authentication:

```bash
ubuntu@ssh-lab:~$ ssh -o PubkeyAuthentication=no -o PreferredAuthentications=password studentuser@localhost
studentuser@localhost: Permission denied (publickey).
```

**Screenshot 3.9:** *[Screenshot showing failed password authentication attempt]*

---

#### Test 3: Authentication from Remote Client (Host Computer)
I tested SSH login from my host computer:

```bash
# From host computer
$ ssh -i ~/studentuser_key studentuser@10.140.83.5
studentuser@ssh-lab:~$ hostname
ssh-lab
studentuser@ssh-lab:~$ exit
logout
Connection to 10.140.83.5 closed.
```

**Screenshot 3.10:** *[Screenshot showing remote SSH connection with key authentication]*

---

#### Test 4: Verify User Cannot Login Without Key
I created a test scenario where the key is not available:

```bash
# From host computer
$ mv ~/studentuser_key ~/studentuser_key.backup
$ ssh studentuser@10.140.83.5
studentuser@10.140.83.5: Permission denied (publickey).
$ mv ~/studentuser_key.backup ~/studentuser_key
```

**Screenshot 3.11:** *[Screenshot showing denied access without proper SSH key]*

---

### Expected Results and Explanation

✅ **Key-based authentication works:** User can log in with SSH key  
✅ **Password authentication disabled:** Cannot log in with password  
✅ **Enhanced security:** Only authorized keys can access the account  
✅ **Backward compatibility maintained:** sftpuser still uses password (via Match block override)

**Security Benefits:**
1. **Stronger authentication:** SSH keys are much more secure than passwords
2. **Protection against brute force:** Passwords cannot be guessed or cracked
3. **Key management:** Private keys can be encrypted with passphrases for extra security
4. **Audit capability:** Key fingerprints provide unique identification
5. **No password exposure:** Credentials never transmitted over the network

---

## Conclusion

### Summary of Achievements

This assignment successfully implemented three critical SSH security configurations:

1. **Disabled Root SSH Access**
   - Prevents direct root login via SSH
   - Forces use of sudo for privilege escalation
   - Creates audit trail for administrative actions

2. **Configured SFTP-Only Access**
   - Created restricted user `sftpuser` for file transfers
   - Implemented chroot jail to limit directory access
   - Blocked interactive shell access while allowing SFTP

3. **Enabled SSH Key-Based Authentication**
   - Set up passwordless authentication for `studentuser`
   - Disabled password-based authentication system-wide
   - Maintained exception for SFTP user when needed

### Security Improvements Achieved

The implemented configurations provide multiple layers of security:

- **Reduced attack surface:** Eliminating root SSH access and password authentication significantly reduces vulnerability to brute force attacks
- **Principle of least privilege:** Users have only the minimum access required for their tasks
- **Isolation:** Chroot jail prevents unauthorized access to system files
- **Authentication strength:** SSH keys provide much stronger authentication than passwords
- **Accountability:** Configuration changes enable better logging and auditing

### Challenges Encountered

1. **Service Name Differences:** Ubuntu uses `ssh` service name instead of `sshd` (as in CentOS). Had to use `systemctl restart ssh` instead of `systemctl restart sshd`.

2. **Path Differences:** Ubuntu's nologin is located at `/usr/sbin/nologin` instead of `/sbin/nologin`.

3. **Log File Location:** Authentication logs are in `/var/log/auth.log` on Ubuntu instead of `/var/log/secure` on CentOS.

4. **Key Transfer:** Since working with Multipass VM, had to copy the private key from VM to host computer for remote testing.

5. **Directory Permissions:** Initial setup of chroot jail required careful attention to ownership - the chroot directory must be owned by root, not the user.

### Lessons Learned

- Always backup configuration files before making changes
- Test configurations incrementally rather than all at once
- Keep at least one terminal session active during SSH configuration changes
- Understand distribution-specific differences (Ubuntu vs CentOS)
- Review logs regularly to verify expected behavior
- Use `sudo sshd -t` to test configuration syntax before restarting the service

### Future Enhancements

Additional security measures that could be implemented:

1. **Fail2Ban:** Install and configure fail2ban to automatically block repeated failed login attempts
2. **Custom SSH Port:** Change default SSH port (22) to reduce automated attacks
3. **Two-Factor Authentication:** Implement 2FA using Google Authenticator or similar
4. **SSH Key Passphrases:** Enforce passphrases on SSH private keys
5. **AllowUsers Directive:** Explicitly whitelist users allowed to SSH
6. **Connection Rate Limiting:** Implement MaxStartups and LoginGraceTime limits

---

## References

1. OpenSSH Official Documentation  
   https://www.openssh.com/manual.html

2. Ubuntu Server Guide - OpenSSH Server  
   https://ubuntu.com/server/docs/service-openssh

3. How To Enable SFTP Without Shell Access on Ubuntu  
   https://www.digitalocean.com/community/tutorials/how-to-enable-sftp-without-shell-access-on-ubuntu-20-04

4. How To Set Up SSH Keys on Ubuntu  
   https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-22-04

5. SSH Key-Based Authentication Guide  
   https://www.ssh.com/academy/ssh/public-key-authentication

6. Multipass Documentation  
   https://multipass.run/docs

7. Linux man pages - sshd_config(5)  
   `man sshd_config`

---

## Appendix A: Complete SSH Configuration

### Relevant Sections of /etc/ssh/sshd_config

```bash
# Authentication settings
PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
KbdInteractiveAuthentication no
UsePAM yes

# SFTP-only user configuration
Match User sftpuser
    ForceCommand internal-sftp
    PasswordAuthentication yes
    ChrootDirectory /home/sftpuser
    PermitTunnel no
    AllowAgentForwarding no
    AllowTcpForwarding no
    X11Forwarding no
```

---

## Appendix B: System State Before and After

### Before Configuration

| Setting | Status |
|---------|--------|
| Root SSH Login | Enabled (prohibit-password) |
| Password Authentication | Enabled |
| SFTP-only users | None |
| SSH Key Authentication | Not configured |

### After Configuration

| Setting | Status |
|---------|--------|
| Root SSH Login | **Disabled** |
| Password Authentication | **Disabled** (except sftpuser) |
| SFTP-only users | **1 user (sftpuser)** with chroot |
| SSH Key Authentication | **Enabled** for studentuser |

---

## Appendix C: Command Reference Used (Ubuntu-Specific)

```bash
# System information
lsb_release -a
ssh -V
hostname
ip addr show

# User management
sudo useradd -m -s /usr/sbin/nologin sftpuser
sudo useradd -m studentuser
sudo passwd username

# SSH configuration
sudo nano /etc/ssh/sshd_config
sudo sshd -t
sudo systemctl restart ssh
sudo systemctl status ssh

# SSH key generation
ssh-keygen -t rsa -b 4096 -C "user@host"
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh

# Directory management
sudo mkdir -p /home/sftpuser/uploads
sudo chown root:root /home/sftpuser
sudo chmod 755 /home/sftpuser
sudo chown sftpuser:sftpuser /home/sftpuser/uploads

# Testing
ssh user@host
ssh -i keyfile user@host
ssh -o PubkeyAuthentication=no user@host
sftp user@host
sudo tail -f /var/log/auth.log

# Verification
ls -la /home/username/.ssh/
getent passwd username
systemctl status ssh

# Multipass specific
multipass info ssh-lab
multipass exec ssh-lab -- command
multipass transfer source destination
```

---

## Appendix D: Ubuntu vs CentOS Differences

| Aspect | Ubuntu | CentOS |
|--------|--------|--------|
| **SSH Service Name** | `ssh` | `sshd` |
| **Service Command** | `systemctl restart ssh` | `systemctl restart sshd` |
| **Log File** | `/var/log/auth.log` | `/var/log/secure` |
| **nologin Path** | `/usr/sbin/nologin` | `/sbin/nologin` |
| **Config Setting** | `KbdInteractiveAuthentication` | `ChallengeResponseAuthentication` |
| **Default Root SSH** | `prohibit-password` | `yes` (older versions) |

---

**End of Report**

*This report demonstrates successful implementation of SSH security configurations on Ubuntu 22.04 LTS using Multipass for Linux system administration. All tasks have been completed, tested, and verified.*