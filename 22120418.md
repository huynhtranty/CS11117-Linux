# SSH Configuration Assignment Report

**Student Name:** Huỳnh Trần Ty 

**Student ID:** 22120418

**Course:** Hệ điều hành Linux và ứng dụng - CQ2023/4

---

## Table of Contents
1. [Introduction](#introduction)
2. [System Information](#system-information)
3. [Task 1: Disable SSH Access for Root User](#task-1-disable-ssh-access-for-root-user)
4. [Task 2: SFTP-Only Access Configuration](#task-2-sftp-only-access-configuration)
5. [Task 3: SSH Key-Based Authentication](#task-3-ssh-key-based-authentication)
6. [Conclusion](#conclusion)
7. [References](#references)

---

## Introduction

This report documents the implementation of three SSH security configurations on a Linux system:
1. Disabling root SSH access
2. Configuring SFTP-only access with chroot jail
3. Setting up SSH key-based authentication

These configurations enhance system security by implementing best practices for remote access management.

---

## System Information

**Operating System:** Ubuntu 22.04 LTS  
**Kernel Version:** 5.15.0-xxx-generic  
**SSH Version:** OpenSSH_8.9p1  
**IP Address:** 10.140.83.5  
**Hostname:** ssh-lab

Command used to verify:
```bash
ubuntu@ssh-lab:~$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.3 LTS
Release:        22.04
Codename:       jammy

ubuntu@ssh-lab:~$ ssh -V
OpenSSH_8.9p1 Ubuntu-3ubuntu0.4, OpenSSL 3.0.2 15 Mar 2022

ubuntu@ssh-lab:~$ hostname
ssh-lab

ubuntu@ssh-lab:~$ ip addr show | grep "inet " | grep -v 127.0.0.1
    inet 10.140.83.5/24 metric 100 brd 10.140.83.255 scope global dynamic enp0s2
```

---

## Task 1: Disable SSH Access for Root User

### Objective
Prevent the root user from logging in via SSH to enhance system security and enforce the principle of least privilege.

### Implementation Steps

#### Step 1: Backup SSH Configuration
Before making any changes, I created a backup of the SSH configuration file:

```bash
ubuntu@ssh-lab:~$ sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup
ubuntu@ssh-lab:~$ ls -l /etc/ssh/sshd_config*
-rw-r--r-- 1 root root 3289 Oct 26 19:54 /etc/ssh/sshd_config
-rw-r--r-- 1 root root 3289 Oct 29 14:15 /etc/ssh/sshd_config.backup
```

**Screenshot 1.1:** 
![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_1.png)

---

#### Step 2: Edit SSH Configuration
I edited the SSH configuration file to disable root login:

```bash
ubuntu@ssh-lab:~$ sudo nano /etc/ssh/sshd_config
```

**Configuration Change:**
```
# Before (line 33):
#PermitRootLogin prohibit-password

# After (line 33):
PermitRootLogin no
```

**Screenshot 1.2:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_1.2.png)

---

#### Step 3: Verify Configuration Syntax

The command returned no errors (exit code 0), confirming the syntax is correct.

**Screenshot 1.3:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_1.3.png)*

---

#### Step 4: Restart SSH Service
Restarted the SSH service to apply the changes:

**Screenshot 1.4:**![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_1.4.png)

---

### Verification and Testing

#### Test 1: Attempt Root Login
I attempted to SSH as root from my host computer:

**Screenshot 1.5:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_1.5.png)

---

#### Test 2: Verify in System Logs
I checked the authentication logs to confirm the denied attempt:

**Screenshot 1.6:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_1.6.png)

---

### Expected Results and Explanation

**Configuration successful:** Root user cannot log in via SSH  
**Service running:** SSH daemon is active and accepting connections  
**Regular users unaffected:** Non-root users can still log in normally

**Security Benefit:** This configuration prevents attackers from directly targeting the root account via SSH. Administrators must first log in as a regular user and then use `sudo` or `su` to gain root privileges, creating an audit trail and adding an extra layer of security.

---

## Task 2: SFTP-Only Access Configuration

### Objective
Create a user account that can access the server via SFTP for file transfers but is restricted from obtaining an interactive SSH shell. Implement a chroot jail to limit the user's access to a specific directory.

### Implementation Steps

#### Step 1: Create SFTP User
I created a new user named `sftpuser` with no login shell:


**Screenshot 2.1:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_2.png)

---

#### Step 2: Create Directory Structure
I created the chroot directory structure with an uploads folder:

**Screenshot 2.2:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_2.2.png)

---

#### Step 3: Set Directory Permissions
I configured the proper ownership and permissions for the chroot jail:


**Explanation:**
- The chroot directory (`/home/sftpuser`) must be owned by root for security
- The uploads directory is owned by sftpuser so they can write files
- Permissions 755 allow read and execute for the chroot directory

**Screenshot 2.3:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_2.3.png)

---

#### Step 4: Configure SSH for SFTP-Only Access
I added a Match block to the SSH configuration for the sftpuser:


**Configuration Added (at the end of the file):**
```
# SFTP-only configuration for sftpuser
Match User sftpuser
    ForceCommand internal-sftp
    PasswordAuthentication yes
    ChrootDirectory /home/sftpuser
    PermitTunnel no
    AllowAgentForwarding no
    AllowTcpForwarding no
    X11Forwarding no
```

**Screenshot 2.4:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_2.4.png)

---

#### Step 5: Test and Restart SSH Service
I verified the configuration syntax and restarted the service:



**Screenshot 2.5:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_2.5.png)

---

### Verification and Testing

#### Test 1: SFTP Access (Should Succeed)
I tested SFTP access from my host computer:



**Screenshot 2.6:**![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_2.6.png)

---

#### Test 2: SSH Shell Access (Should Fail)
I attempted to get a shell via SSH:


**Screenshot 2.7:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_2.7.png)


---

### Expected Results and Explanation

**SFTP access granted:** User can connect via SFTP and transfer files  
**SSH shell denied:** User cannot obtain an interactive shell  
**Chroot jail active:** User is restricted to `/home/sftpuser` directory  
**File operations work:** User can upload/download files in the uploads directory

**Security Benefits:**
1. **Limited access:** User cannot access system files or other users' data
2. **No shell execution:** Prevents running arbitrary commands on the server
3. **Isolated environment:** Chroot jail contains the user to a specific directory tree
4. **Audit trail:** All file transfers are logged by the SSH daemon

---

## Task 3: SSH Key-Based Authentication

### Objective
Configure SSH key-based authentication for a user account and disable password-based authentication to enhance security.

### Implementation Steps

#### Step 1: Create User Account
I created a user account named `studentuser`:

**Screenshot 3.1:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.1.png)

---

#### Step 2: Generate SSH Key Pair
I switched to the studentuser account and generated an SSH key pair:


**Screenshot 3.2:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.2.png)

---

#### Step 3: View Public Key
I displayed the generated public key:

**Screenshot 3.3:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.3.png)

---

#### Step 4: Configure Authorized Keys
I set up the authorized_keys file:


**Screenshot 3.4:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.4.png)

---

#### Step 5: Test Key-Based Authentication
I tested SSH login using the private key:

**Screenshot 3.5:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.5.png)
---

#### Step 6: Copy Private Key to Host Computer (for remote testing)

Since the key was generated inside the VM, I need to copy the private key to my host computer:


**Screenshot 3.5b:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.5b.png)

---

#### Step 7: Disable Password Authentication
I edited the SSH configuration to disable password authentication:


**Configuration Changes:**
```
# Around line 57: Enable public key authentication
PubkeyAuthentication yes

# Around line 58: Disable password authentication
PasswordAuthentication no

# Around line 62: Disable challenge-response authentication
KbdInteractiveAuthentication no
```

**Note:** I also added an exception for the sftpuser to maintain their password access:
```
# Before the Match User sftpuser block, ensure these are set:
PasswordAuthentication no

# Inside Match User sftpuser block, override:
Match User sftpuser
    PasswordAuthentication yes
    # ... other settings ...
```

**Screenshot 3.6:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.7.png)

---

#### Step 8: Apply Configuration Changes
I tested and restarted the SSH service:

**Screenshot 3.7:** ![05 - Joining Data](https://raw.githubusercontent.com/huynhtranty/CS11117-Linux/main/image/05_3.71.png)

---

### Verification and Testing

#### Test 1: Key-Based Authentication 
I verified that key-based authentication still works:

```bash
ubuntu@ssh-lab:~$ ssh studentuser@localhost
studentuser@ssh-lab:~$ hostname
ssh-lab
studentuser@ssh-lab:~$ exit
logout
Connection to localhost closed.
```


---

#### Test 2: Password Authentication (Should Fail)
I attempted to force password authentication:

```bash
ubuntu@ssh-lab:~$ ssh -o PubkeyAuthentication=no -o PreferredAuthentications=password studentuser@localhost
studentuser@localhost: Permission denied (publickey).
```


---

#### Test 3: Authentication from Remote Client (Host Computer)
I tested SSH login from my host computer:

```bash
# From host computer
$ ssh -i ~/studentuser_key studentuser@10.140.83.5
studentuser@ssh-lab:~$ hostname
ssh-lab
studentuser@ssh-lab:~$ exit
logout
Connection to 10.140.83.5 closed.
```


---

#### Test 4: Verify User Cannot Login Without Key
I created a test scenario where the key is not available:

```bash
# From host computer
$ mv ~/studentuser_key ~/studentuser_key.backup
$ ssh studentuser@10.140.83.5
studentuser@10.140.83.5: Permission denied (publickey).
$ mv ~/studentuser_key.backup ~/studentuser_key
```